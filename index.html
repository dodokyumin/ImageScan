<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ê°ì • í‰ê°€</title>
    <script src="https://unpkg.com/axios@0.24.0/dist/axios.min.js"></script>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© css ì‚¬ìš© -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <style>
      #image_container > img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row text-center">
        <div class="col-md-12 m-4"><h1>ì§€ê¸ˆ ì–´ë–¤ ê°ì •ì¼ê¹Œìš”?ğŸ¤”</h1></div>
      </div>

      <div class="row m-5">
        <div class="col-md-2 text-center"></div>
        <div
          class="col-md-8 text-center"
          id="image_container"
          style="
            padding: 0px;
            height: 300px;
            width: 600px;
            border: 2px solid gray;
          "
        >
          <p style="margin-top: 20%" id="notice">íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
        <div class="col-md-2 text-center"></div>
      </div>

      <div class="row">
        <div class="col-md-2 text-center"></div>
        <div class="col-md-4 text-center">
          <input
            type="file"
            accept="image/*"
            onchange="setThumbnail(event)"
            id="fileInput"
          />
        </div>
        <div class="col-md-4 text-center">
          <button id="uploadButton">í…ŒìŠ¤íŠ¸!</button>
        </div>
        <div class="col-md-2 text-center"></div>
      </div>

      <div class="row">
        <div class="col-xs-12 text-center m-5">
          <div id="setting" style="display: none">
            ì–´ë–¤ ê°ì •ì¼ê¹Œìš”? <í…ŒìŠ¤íŠ¸!> ë²„íŠ¼ì„ ëˆŒëŸ¬ í™•ì¸í•´ì£¼ì„¸ìš”!
          </div>
          <div id="loading" style="display: none">ë¶„ì„ì¤‘...</div>
          <div id="result" style="display: none">
            <p>í–‰ë³µí•´ìš”ğŸ˜„ <b id="happiness"></b> %</p>
            <p>ê·¸ëƒ¥ê·¸ë˜ìš”ğŸ˜ <b id="neutral"></b> %</p>
            <p>í™”ê°€ë‚˜ìš”ğŸ˜¡ <b id="anger"></b> %</p>
            <p>ìŠ¬í¼ìš”ğŸ˜¥ <b id="sadness"></b> %</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let photo = document.getElementById("photo");
      let result = document.getElementById("result");
      let loading = document.getElementById("loading");
      let setting = document.getElementById("setting");
      let image_container = document.getElementById("image_container");

      document.getElementById("uploadButton").onclick = () => {
        loading.style.display = "block";
        setting.style.display = "none";
        result.style.display = "none";

        let fileElement = document.getElementById("fileInput");

        // check if user had selected a file
        if (fileElement.files.length === 0) {
          alert("please choose a file");
          return;
        }

        let file = fileElement.files[0];

        let formData = new FormData();
        formData.set("file", file);

        axios
          .post("http://192.168.23.89:8000/compare", formData, {
            onUploadProgress: (progressEvent) => {
              const percentCompleted = Math.round(
                (progressEvent.loaded * 100) / progressEvent.total
              );
              console.log(`upload process: ${percentCompleted}%`);
            },
          })
          .then((res) => {
            console.log(res.data);
            var angerPercent = document.getElementById("anger");
            var happinessPercent = document.getElementById("happiness");
            var neutralPercent = document.getElementById("neutral");
            var sadnessPercent = document.getElementById("sadness");

            angerPercent.innerHTML = Math.floor(res.data.anger * 100);
            happinessPercent.innerHTML = Math.floor(res.data.happiness * 100);
            neutralPercent.innerHTML = Math.floor(res.data.neutral * 100);
            sadnessPercent.innerHTML = Math.floor(res.data.sadness * 100);

            result.style.display = "block";
            loading.style.display = "none";
          });
      };

      function setThumbnail(event) {
        var reader = new FileReader();

        reader.onload = function (event) {
          if (image_container.childElementCount != 0) {
            image_container.removeChild(image_container.children[0]);
          }

          var img = document.createElement("img");
          img.setAttribute("src", event.target.result);
          document.querySelector("div#image_container").appendChild(img);
        };

        reader.readAsDataURL(event.target.files[0]);

        setting.style.display = "block";
        result.style.display = "none";
      }
    </script>
  </body>
</html>
